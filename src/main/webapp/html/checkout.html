<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PGDemo</title>

</head>
<body>
<div id="head" style=" weight:100%; height:30px; background-color: aqua;text-align: left">&nbsp;&nbsp;&nbsp;settle accounts</div>
<div>
    <h1>0.01¥ 银行卡支付结算</h1>
                 <input type="radio" name="bankCardType" value="CREDIT_CARD" >信用卡&nbsp<input type="radio" name="bankCardType" value="DEBIT_CARD" checked>借记卡<br>
        银行卡号：<input id="cardNumber" type="text" name="number"/><br>
        银行代码：<input id="bankType" type="text" name="bankcode"><br>
        持卡人：<input  id="name" type="text" name="payername"/><br>
        身份证号：<input id="idNumber"type="text" name="citizenIdNumber"/><br>
        银行预留手机号：<input type="text" id="phone" name="phone"><br>
        验证码：<input id="verifyCode" type ="text" name="verifyCode"/><button id="verify" value="获取验证码">获取验证码</button>
        <button  id="confirm">确认支付</button>
</div>

</body>


<script src="https://cdn.bootcss.com/jquery/2.2.2/jquery.min.js"></script>
<script src="../html/js/datejs.js"></script>
<script>
    var amount1 = new Object();
    amount1.total = "0.01";
    amount1.currency = "CNY";
    var sub_order1 = new Object();
    sub_order1.amount = amount1;
    sub_order1.mer_sub_reference_id = Math.random().toString(36).substr(4);
    sub_order1.order_summary = "rest demo test";
    sub_order1.trans_code = "01121990";
    sub_order1.is_customs = "TRUE";
    sub_order1.sub_trans_type = "1";
    var item1 = new Object();
    item1.mer_item_id = "071815243911";
    item1.type = "FOOD";
    item1.name = "Beef";
    item1.description = "beef";
    item1.quantity = "2";
    var amount2 = new Object();
    amount2.total = "0.01";
    amount2.currency = "CNY";
    item1.amount = amount2;
    var items = new Array();
    items[0] = item1;
    sub_order1.items=items;
    var order = new Object();
    order.mer_reference_id = Math.random().toString(36).substr(2);
    var date = new Date();
    order.mer_date = date.Format("yyyyMMdd");
    console.log(order.mer_date);
    var amount = new Object();
    amount.total = "0.01";
    amount.currency = "CNY";
    order.amount = amount;
    order.expire_time="360";
    var sub_orders = new Array();
    sub_orders[0] = sub_order1;
    order.sub_orders= sub_orders;
    order.user_ip = "10.1.1.1";
    var risk_info=new Object();
    risk_info.trans_type="02";
    risk_info.goods_type="1";
    risk_info.business_type="Y";
    risk_info.real_name="0";
    var bankcard=new Object();
    var payer=new Object();
    var payer_info=new Object();
    var payment=new Object();
    $("#verify").on("click",function () {
        bankcard.number=$("#cardNumber").val();
        bankcard.citizen_id_number=$("#idNumber").val();
        bankcard.payername=$("#name").val();
        bankcard.phone=$("#phone").val();
        bankcard.citizen_id_type="IDENTITY_CARD";
        payer_info.bank_card=bankcard;
        payer_info.phone=$("#phone").val();
        payer.payer_info=payer_info;
        payer.payment_method=$("input[name='bankCardType']:checked").val();
        payer.bank_code=$("#bankType").val().toUpperCase();
        payer.interface_type="SERVER_TO_SERVER";
        payment.payer=payer;
        payment.order=order;
        payment.risk_info=risk_info;
        payment.notify_url="https://localhost:8080/clientdemo/notifyResult";
        console.log(bankcard.number);
        console.log(bankcard.payername);
        console.log(bankcard.phone);
        console.log( payer.bank_code);
        $.ajax("/clientDemo/pay/placeOder",{
            method:"POST",
            contentType :"application/json; charset=utf-8",
            data:JSON.stringify(payment),
            dataType:"json",
            success:function(data){
             console.log(data);
             payment.id=data;
            },
            error:function(err){
                console.log(err);
            }
        })
   });
    $("#confirm").on("click",function(){
        bankcard.verify_code=$("#verifyCode").val();
        console.log(payment);
        $.ajax("/clientDemo/pay/confirm",{
            method:"POST",
            contentType :"application/json; charset=utf-8",
            data:JSON.stringify(payment),
            dataType:"json",
            success:function(data){
                alert(data);
                console.log(data);
            },
            error:function(err){
                console.log(err);
            }
        })

    });
</script>
</html>
